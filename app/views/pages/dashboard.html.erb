<h1>Dashboard</h1>
<div data-controller="buttonsvalidation">
  <h2>Réservations de mes rêves</h2>
  <% @dreams.each do |dream| %>
    <% @allbookings.each do |booking| %>
      <% if (booking.dream == dream) %>
        <%= dream.title %>
        <%= User.find(booking.user_id).username %>
        <button class="btn btn-success" data-action="click->buttonsvalidation#validate" data-buttonsvalidation-target="validateBtn">Validé</button>
        <button class="btn btn-danger" data-action="click->buttonsvalidation#decline" data-buttonsvalidation-target="declineBtn">Refusé</button>
          <% if booking.status == archived %>
            <p>Validé</p>
          <% elsif booking.status == decline %>
            <p>Refusé</p>
          <% else %>
            <p>En attente</p>
          <% end %>
      <% end %>
    <% end %>
  <% end %>
</div>
<h2>Mes réservations</h2>
<ul>
  <% @bookings.each do |booking| %>
    <li>
      <%= booking.user_id %>
      <%= booking.dream.title %>
      <%= booking.reservation_date %>
      <%= link_to "Annuler réservation",
      booking_path(booking),
      data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}
      %>
    </li>
  <% end %>
</ul>
<h2>Mes rêves</h2>
<ul>
  <% @dreams.each do |dream| %>
    <li>
      <%= dream.user_id %>
      <%= dream.title %>
      <%= link_to "Supprimer rêve",
      dream_path(dream),
      data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}
      %>
      <%  if (dream.picture.attached?) %>
        <div class="dreamcard">
          <img class="dreamcard-image" src="<%= cl_image_path dream.picture.key %>" alt="">
          <div class="dreamcard-info">
            <p class="tag"> <%= dream.category %> </p>
            <h2> <%= dream.title %> </h2>
            <p> <%= dream.description.truncate(100, separator: ' ') %> </p>
            <div class="dreamcard-price">
              <p class="price"><%= number_with_precision(dream.price, precision: 2, separator: ".") %>€</p>
              <p>/nuit</p>
            </div>
            <%= link_to "Voir le rêve", dream_path(dream), class: "button" %>
          </div>
        </div>
      <% else %>
        <div class="dreamcard">
          <img class="dreamcard-image" src="#" alt="">
          <div class="dreamcard-info">
            <h2> <%= dream.title %> </h2>
            <div class="dreamcard-tags">
              <p class="tag"> <%= dream.category %> </p>
            </div>
            <p class="dreamcard-text"> <%= dream.price %> </p>
            <%= link_to "Voir le rêve", dream_path(dream), class: "btn btn-primary" %>
          </div>
        </div>
      <% end %>
    </li>
  <% end %>
</ul>
